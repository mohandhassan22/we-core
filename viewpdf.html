<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>عرض النموذج</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    body{
      font-family:Tahoma, Arial, sans-serif;
      margin:0;
      background:#f8f0ff;
      color:#333
    }
    .header{
      background:#6a1b9a;
      color:#fff;
      padding:12px
    }
    .container{
      max-width:1100px;
      margin:20px auto;
      padding:12px
    }
    .actions{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-end;
      margin-bottom:15px
    }
    .actions a, .actions button{
      background:#6a1b9a;
      color:#fff;
      padding:8px 12px;
      border-radius:6px;
      text-decoration:none;
      border:none;
      cursor:pointer;
      transition:0.3s
    }
    .actions a:hover, .actions button:hover{
      background:#8e24aa
    }
    .actions button:disabled{
      background:#ccc;
      cursor:not-allowed
    }
    #viewerWrap{
      background:#fff;
      border:1px solid #ddd;
      border-radius:8px;
      overflow:hidden
    }
    iframe{
      width:100%;
      height:calc(100vh - 160px);
      border:none;
      display:none
    }
    .loading{
      text-align:center;
      padding:40px;
      color:#6a1b9a
    }
    .loading i{
      font-size:2em;
      animation: spin 1s linear infinite
    }
    @keyframes spin{
      from{transform:rotate(0)}
      to{transform:rotate(360deg)}
    }
    #error{
      text-align:center;
      padding:40px;
      color:#999;
      display:none
    }
  </style>
</head>

<body>

  <div class="header">
    <div class="container">
      <strong>عرض النموذج</strong>
    </div>
  </div>

  <div class="container">

    <div class="actions">
      <a href="pdf.html"><i class="fas fa-arrow-right"></i> رجوع</a>
      <button id="printBtn"><i class="fas fa-print"></i> طباعة</button>
    </div>

    <div id="viewerWrap">
      <div id="loading" class="loading">
        <i class="fas fa-spinner"></i>
        <p>جاري تحميل الملف...</p>
      </div>

      <p id="error">تعذر تحميل الملف. تأكد أن الملف متاح للعرض.</p>

      <iframe id="pdfViewer"></iframe>
    </div>

  </div>

<script>
  function getQuery(name){
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
  }

  const src = getQuery('src');
  const iframe = document.getElementById('pdfViewer');
  const loading = document.getElementById('loading');
  const error = document.getElementById('error');
  const printBtn = document.getElementById('printBtn');

  if(!src){
    loading.style.display = 'none';
    error.style.display = 'block';
    printBtn.disabled = true;
  }else{
    const originalUrl = decodeURIComponent(src);

    // Google Docs Viewer (نفس رابط googleusercontent)
    const viewUrl =
      `https://docs.google.com/gview?embedded=true&url=${encodeURIComponent(originalUrl)}`;

    iframe.src = viewUrl;

    iframe.onload = () => {
      loading.style.display = 'none';
      iframe.style.display = 'block';
    };

    iframe.onerror = () => {
      loading.style.display = 'none';
      error.style.display = 'block';
    };

    // الطباعة
    printBtn.onclick = () => {
      try{
        iframe.contentWindow.focus();
        iframe.contentWindow.print();
      }catch{
        window.open(viewUrl, '_blank');
      }
    };
  }
</script>

</body>
</html>
