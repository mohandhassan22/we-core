<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>عرض النموذج</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    body{
      margin:0;
      font-family:Tahoma, Arial, sans-serif;
      background:#f4f4f4
    }
    .header{
      background:#6a1b9a;
      color:#fff;
      padding:12px
    }
    .container{
      max-width:1200px;
      margin:auto;
      padding:12px
    }
    .actions{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      margin-bottom:10px
    }
    .actions a,.actions button{
      background:#6a1b9a;
      color:#fff;
      border:none;
      padding:8px 14px;
      border-radius:6px;
      cursor:pointer;
      text-decoration:none
    }
    .actions a:hover,.actions button:hover{
      background:#8e24aa
    }
    iframe{
      width:100%;
      height:calc(100vh - 150px);
      border:none;
      display:none;
      background:#fff
    }
    .loading,.error{
      text-align:center;
      padding:40px;
      color:#666
    }
    .loading i{
      font-size:30px;
      color:#6a1b9a;
      animation:spin 1s linear infinite
    }
    @keyframes spin{
      from{transform:rotate(0)}
      to{transform:rotate(360deg)}
    }
  </style>
</head>

<body>

<div class="header">
  <div class="container">
    <strong>عرض النموذج</strong>
  </div>
</div>

<div class="container">

  <div class="actions">
    <a href="pdf.html"><i class="fas fa-arrow-right"></i> رجوع</a>
    <button id="printBtn"><i class="fas fa-print"></i> طباعة</button>
  </div>

  <div id="loading" class="loading">
    <i class="fas fa-spinner"></i>
    <p>جاري تحميل الملف...</p>
  </div>

  <div id="error" class="error" style="display:none">
    تعذر عرض الملف – تأكد أن الملف متاح للعامة
  </div>

  <iframe id="viewer"></iframe>

</div>

<script>
  function getQuery(name){
    return new URLSearchParams(window.location.search).get(name);
  }

  function driveToDirect(url){
    if(url.includes("drive.google.com")){
      const match = url.match(/\/d\/([^\/]+)/);
      if(match){
        return "https://drive.google.com/uc?export=download&id=" + match[1];
      }
    }
    return url;
  }

  const src = getQuery("src");
  const iframe = document.getElementById("viewer");
  const loading = document.getElementById("loading");
  const error = document.getElementById("error");
  const printBtn = document.getElementById("printBtn");

  if(!src){
    loading.style.display="none";
    error.style.display="block";
    printBtn.disabled=true;
  }else{
    const originalUrl = decodeURIComponent(src);
    const directPdf = driveToDirect(originalUrl);

    const viewerUrl =
      "https://docs.google.com/gview?embedded=true&url=" +
      encodeURIComponent(directPdf);

    iframe.src = viewerUrl;

    iframe.onload = ()=>{
      loading.style.display="none";
      iframe.style.display="block";
    };

    iframe.onerror = ()=>{
      loading.style.display="none";
      error.style.display="block";
    };

    printBtn.onclick = ()=>{
      try{
        iframe.contentWindow.focus();
        iframe.contentWindow.print();
      }catch{
        window.open(directPdf,"_blank");
      }
    };
  }
</script>

</body>
</html>

